<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–æ—ç—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∏–ª—å–º</title>
    
    <!-- –ü–†–û–°–¢–û–ô –ò –ö–†–ê–°–ò–í–´–ô –®–†–ò–§–¢ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Merriweather', serif;
            background: #000;
            color: white;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
        #main {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 1;
            transition: opacity 0.5s;
        }
        
        /* –§–û–ù–´ - –û–ë–ù–û–í–õ–ï–ù–û –î–õ–Ø –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô */
        .scene-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1.2s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .scene-bg.active { 
            opacity: 1; 
        }
        
        /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞ */
        .scene-bg::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }
        
        /* –î–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–Ω–æ–π —Å—Ü–µ–Ω—ã –¥–µ–ª–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Å–∏–ª—å–Ω–µ–µ */
        #envelopeScene .scene-bg::after {
            background: rgba(0, 0, 0, 0.5);
        }
        
        /* –ß—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –±—ã–ª –ø–æ–≤–µ—Ä—Ö –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è */
        .text-line, .dots, .music-btn, .back-button {
            position: relative;
            z-index: 3;
        }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –≠–§–§–ï–ö–¢–û–í */
        .effects-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            overflow: hidden;
        }
        
        /* –û–ë–©–ò–ï –°–¢–ò–õ–ò –î–õ–Ø –≠–§–§–ï–ö–¢–û–í */
        .effect {
            position: absolute;
            pointer-events: none;
        }
        
        /* –ö–õ–ê–°–°–´ –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –í–ò–î–ò–ú–û–°–¢–¨–Æ –≠–§–§–ï–ö–¢–û–í */
        .effect.hidden {
            opacity: 0 !important;
            visibility: hidden !important;
        }
        
        .effect.visible {
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        /* –≠–§–§–ï–ö–¢ 1: –†–û–ó–û–í–´–ï –õ–ï–ü–ï–°–¢–ö–ò (–°–¶–ï–ù–ê 2) */
        .petal {
            width: 15px;
            height: 15px;
            background: linear-gradient(45deg, #ffb6c1, #ff69b4);
            border-radius: 50% 0 50% 50%;
            transform: rotate(45deg);
            position: absolute;
            filter: blur(0.5px);
            animation: floatPetal linear infinite;
        }
        
        @keyframes floatPetal {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* –≠–§–§–ï–ö–¢ 2: –ì–û–†–Ø–©–ò–ô –û–ì–û–ù–¨ (–°–¶–ï–ù–ê 3) */
        .fire-effect {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: linear-gradient(to top, 
                rgba(255, 0, 0, 0) 0%,
                rgba(255, 69, 0, 0.6) 20%,
                rgba(255, 140, 0, 0.4) 40%,
                rgba(255, 215, 0, 0.2) 60%,
                rgba(255, 255, 255, 0) 100%);
            opacity: 0.7;
            filter: blur(10px);
            animation: flickerFire 2s ease-in-out infinite alternate;
        }
        
        .fire-particle {
            position: absolute;
            bottom: 0;
            width: 5px;
            height: 5px;
            background: #ff4500;
            border-radius: 50%;
            filter: blur(2px);
            animation: riseUp 3s ease-in infinite;
        }
        
        @keyframes flickerFire {
            0%, 100% { 
                opacity: 0.6;
                transform: scaleY(1);
            }
            50% { 
                opacity: 0.8;
                transform: scaleY(1.1);
            }
        }
        
        @keyframes riseUp {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) scale(0);
                opacity: 0;
            }
        }
        
        /* –≠–§–§–ï–ö–¢ 3: –°–ò–Ø–ù–ò–ï –°–í–ï–†–•–£ (–°–¶–ï–ù–ê 4) */
        .glow-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background: radial-gradient(
                ellipse at center,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0.1) 40%,
                rgba(255, 255, 255, 0) 70%
            );
            animation: glowPulse 4s ease-in-out infinite alternate;
        }
        
        .glow-particle {
            position: absolute;
            top: 50px;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            filter: blur(1px);
            animation: glowFloat 6s ease-in-out infinite;
        }
        
        @keyframes glowPulse {
            0% { 
                opacity: 0.3;
                transform: translateY(-10px);
            }
            100% { 
                opacity: 0.6;
                transform: translateY(10px);
            }
        }
        
        @keyframes glowFloat {
            0%, 100% {
                transform: translateX(-100px) translateY(0);
                opacity: 0.3;
            }
            50% {
                transform: translateX(100px) translateY(20px);
                opacity: 0.6;
            }
        }
        
        /* –≠–§–§–ï–ö–¢ 4: –ú–ï–†–¶–ê–Æ–©–ò–ï –û–ì–û–ù–¨–ö–ò (–°–¶–ï–ù–ê 5) */
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            filter: blur(0.5px);
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
            animation: sparkleTwinkle 3s ease-in-out infinite;
        }
        
        @keyframes sparkleTwinkle {
            0%, 100% { 
                opacity: 0.2;
                transform: scale(0.8);
            }
            50% { 
                opacity: 1;
                transform: scale(1.2);
            }
        }
        
        /* –≠–§–§–ï–ö–¢ 5: –ü–ê–î–ê–Æ–©–ò–ô –°–ù–ï–ì (–°–¶–ï–ù–ê 6) */
        .snowflake {
            position: absolute;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            filter: blur(0.5px);
            animation: fallSnow linear infinite;
        }
        
        @keyframes fallSnow {
            0% {
                transform: translateY(-10px) translateX(0) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) translateX(100px) rotate(180deg);
                opacity: 0;
            }
        }
        
        /* –î–ª—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Å—Ü–µ–Ω—ã (–±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) */
        .start-scene::after {
            display: none;
        }
        
        /* –ù–ê–ß–ê–õ–¨–ù–ê–Ø –°–¶–ï–ù–ê (–ó–ê–ü–£–°–ö–ê–Æ–©–ê–Ø) */
        .start-scene {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 30px;
            z-index: 10;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
        }
        
        .start-title {
            font-size: clamp(2.5rem, 8vw, 3.5rem);
            font-weight: 300;
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s ease-out 0.5s forwards;
        }
        
        .start-subtitle {
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            font-weight: 300;
            margin-bottom: 40px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease-out 1s forwards;
            color: rgba(255,255,255,0.8);
        }
        
        .start-button {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 18px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease-out 1.5s forwards;
            transition: all 0.3s;
            font-family: 'Merriweather', serif;
            letter-spacing: 1px;
            backdrop-filter: blur(10px);
        }
        
        .start-button:active {
            background: rgba(255,255,255,0.1);
            transform: scale(0.98);
        }
        
        .start-hint {
            position: absolute;
            bottom: 30px;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.6);
            opacity: 0;
            animation: fadeIn 1s ease-out 2s forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        /* –û–°–ù–û–í–ù–´–ï –°–¶–ï–ù–´ –° –¢–ï–ö–°–¢–û–ú */
        .text-container {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.8s;
        }
        
        .text-container.active {
            opacity: 1;
        }
        
        .text-line {
            position: absolute;
            text-align: center;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.9s cubic-bezier(0.16, 1, 0.3, 1);
            max-width: 85%;
            padding: 30px 25px;
            
            /* –£–ë–ò–†–ê–ï–ú –ß–Å–†–ù–´–ô –§–û–ù –ò –†–ê–ú–ö–ò */
            background: transparent !important;
            border: none !important;
            backdrop-filter: none;
            box-shadow: none;
        }
        
        .text-line.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* –û–î–ò–ù –®–†–ò–§–¢ –î–õ–Ø –í–°–ï–• –°–¶–ï–ù - Merriweather */
        .text {
            font-family: 'Merriweather', serif;
            font-size: clamp(1.3rem, 4vw, 2rem);
            line-height: 1.4;
            font-weight: 300;
            letter-spacing: 0.3px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
            
            /* –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω */
            background: linear-gradient(45deg, #ffffff, #f8f8f8, #ffffff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            background-size: 200% auto;
        }
        
        /* –†–ê–ó–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –î–õ–Ø –†–ê–ó–ù–´–• –°–¢–†–û–ö (–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞) */
        .text-line[data-scene="1"] .text {
            font-weight: 400;
            font-style: italic;
            font-size: clamp(1.3rem, 4vw, 2rem);
        }
        
        .text-line[data-scene="2"] .text {
            font-weight: 400;
	    font-style: italic;
	    font-size: clamp(1.3rem, 4vw, 2rem);
        }
        
        .text-line[data-scene="3"] .text {
            font-weight: 400;
            font-style: italic;
	    font-size: clamp(1.3rem, 4vw, 2rem);
        }
        
        .text-line[data-scene="4"] .text {
            font-weight: 400;
	    font-style: italic;
	    font-size: clamp(1.3rem, 4vw, 2rem);
        }
        
        .text-line[data-scene="5"] .text {
            font-weight: 400;
font-style: italic;
            font-size: clamp(1.3rem, 4vw, 2rem);
        }
        
        .text-line[data-scene="6"] .text {
            font-weight: 400;
font-style: italic;
            font-size: clamp(1.3rem, 4vw, 2rem);
        }
        
        @keyframes textPulse {
            0% { 
                filter: brightness(1);
                background-size: 100% auto;
            }
            100% { 
                filter: brightness(1.3);
                background-size: 200% auto;
            }
        }
        
        /* –ò–ù–î–ò–ö–ê–¢–û–† */
        .dots {
            position: absolute;
            bottom: 25px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 12px;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .dots.active {
            opacity: 1;
        }
        
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            cursor: pointer;
        }
        
        .dot.active {
            background: #ff6b6b;
            transform: scale(1.4);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }
        
        /* –û–¢–î–ï–õ–¨–ù–ê–Ø –°–¶–ï–ù–ê –ö–û–ù–í–ï–†–¢–ê */
        .envelope-scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f3460, #533483);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s;
            z-index: 20;
            overflow: hidden;
        }
        
        .envelope-scene.active {
            opacity: 1;
            pointer-events: all;
        }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ö–û–ù–í–ï–†–¢–ê –ò –ü–ò–°–¨–ú–ê */
        .envelope-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 100px;
        }
        
        /* –ü–û–õ–ù–û–¶–ï–ù–ù–´–ô –ö–û–ù–í–ï–†–¢ */
        .envelope-wrapper {
            position: relative;
            width: 280px;
            height: 190px;
            perspective: 1000px;
            z-index: 2;
        }
        
        .envelope {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .envelope:hover {
            transform: translateY(-5px);
        }
        
        /* –û–°–ù–û–í–ù–ê–Ø –ß–ê–°–¢–¨ –ö–û–ù–í–ï–†–¢–ê */
        .envelope-base {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f5cac3, #f7d7c4);
            border-radius: 8px;
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.4),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            z-index: 1;
        }
        
        /* –ö–õ–ê–ü–ê–ù –ö–û–ù–í–ï–†–¢–ê */
        .envelope-flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f28482, #f5a3a2);
            border-radius: 8px 8px 0 0;
            transform-origin: top;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 2;
            box-shadow: 0 -3px 10px rgba(0,0,0,0.2);
            
            /* –°–æ–∑–¥–∞—ë–º —Ç—Ä–µ—É–≥–æ–ª—å–Ω—É—é —Ñ–æ—Ä–º—É –∫–ª–∞–ø–∞–Ω–∞ */
            clip-path: polygon(0% 0%, 100% 0%, 50% 50%);
        }
        
        .envelope.open .envelope-flap {
            transform: rotateX(180deg);
        }
        
        /* –ü–û–ß–¢–û–í–ê–Ø –ú–ê–†–ö–ê */
        .envelope-stamp {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 50px;
            height: 35px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border-radius: 4px;
            z-index: 3;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            
            /* –¢–µ–∫—Å—Ç –Ω–∞ –º–∞—Ä–∫–µ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            transform: rotate(5deg);
        }
        
        /* –ê–î–†–ï–° –ù–ê –ö–û–ù–í–ï–†–¢–ï */
        .envelope-address {
            position: absolute;
            bottom: 30px;
            left: 25px;
            font-family: 'Merriweather', serif;
            font-size: 0.9rem;
            color: #5a3921;
            z-index: 3;
            text-shadow: 0 1px 1px rgba(255,255,255,0.5);
        }
        
        /* –ü–ò–°–¨–ú–û - –ò–ó–ù–ê–ß–ê–õ–¨–ù–û –°–ö–†–´–¢–û –í–ù–£–¢–†–ò –ö–û–ù–í–ï–†–¢–ê */
        .letter-wrapper {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 240px;
            min-height: 100px;
            perspective: 1000px;
            z-index: 0;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
        }
        
        /* –ö–æ–≥–¥–∞ –∫–æ–Ω–≤–µ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –í–ï–†–•–ù–Æ–Æ –ß–ê–°–¢–¨ –ø–∏—Å—å–º–∞ */
        .envelope.open .letter-wrapper {
            opacity: 1;
            visibility: visible;
            z-index: 1;
            transform: translateY(-20px);
            height: 40px !important;
            min-height: 40px !important;
            overflow: hidden !important;
            pointer-events: none;
        }
        
        /* –ö–æ–≥–¥–∞ –ø–∏—Å—å–º–æ –í–´–ï–ó–ñ–ê–ï–¢ –∏–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞ (–≤—Ç–æ—Ä–æ–π –∫–ª–∏–∫) */
        .letter-wrapper.extracted {
            top: -100px !important;
            left: 20px !important;
            width: 260px !important;
            height: auto !important;
            min-height: 100px !important;
            z-index: 10 !important;
            transform: translateY(0) !important;
            opacity: 1 !important;
            visibility: visible !important;
            pointer-events: all !important;
            overflow: visible !important;
        }
        
        /* –ö–õ–Æ–ß–ï–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–∏—Å—å–º–æ –≤ —Ü–µ–Ω—Ç—Ä–µ —ç–∫—Ä–∞–Ω–∞ –ë–ï–ó –≤—ã–ª–µ—Ç–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã */
        .letter-wrapper.centered {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            transform: none !important;
            z-index: 30 !important;
            opacity: 1 !important;
            visibility: visible !important;
            pointer-events: all !important;
            overflow: auto !important;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 20px !important;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∏—Å—å–º–∞ */
        .letter-container {
            width: 90%;
            max-width: 400px;
            max-height: 70vh;
            transform-origin: center;
            transition: transform 0.3s;
        }
        
        .letter-wrapper.centered .letter-container {
            animation: letterScale 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        
        @keyframes letterScale {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .letter {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 250px;
            transform-style: preserve-3d;
            cursor: pointer;
            transition: transform 0.8s ease;
            opacity: 1 !important;
            visibility: visible !important;
            transform-origin: center;
        }
        
        .letter.flipped {
            transform: rotateY(180deg);
        }
        
        /* –õ–ò–¶–ï–í–ê–Ø –°–¢–û–†–û–ù–ê –ü–ò–°–¨–ú–ê */
        .letter-front, .letter-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 6px;
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.25),
                inset 0 1px 0 rgba(255,255,255,0.8);
            overflow: hidden;
        }
        
        .letter-front {
            background: #fefae0;
            transform: rotateY(0deg);
            display: flex;
            flex-direction: column;
            padding: 25px 30px 35px 30px;
        }
        
        .letter-back {
            background: #fefae0;
            transform: rotateY(180deg);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        
        .letter-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .letter-title {
            font-family: 'Merriweather', serif;
            font-size: 1.5rem;
            color: #9d5c63;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
            line-height: 1.3;
            flex-shrink: 0;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç–∞ —Å –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π */
        .text-scroll-container {
            position: relative;
            flex: 1;
            overflow: hidden;
            min-height: 150px;
            max-height: 200px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 15px;
        }
        
        .text-content {
            position: absolute;
            width: 100%;
            padding-right: 10px;
            color: #333333 !important;
            font-family: 'Merriweather', serif;
            font-size: 0.7rem;
            line-height: 1.6;
            animation: scrollText 40s linear infinite;
            animation-play-state: paused;
            top: 0;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        @keyframes scrollText {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-100%);
            }
        }
        
        /* –ö–ª–∞—Å—Å –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        .text-content.scrolling {
            animation-play-state: running;
        }
        
        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ */
        .text-scroll-container::before,
        .text-scroll-container::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 30px;
            pointer-events: none;
            z-index: 2;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .text-scroll-container::before {
            top: 0;
            background: linear-gradient(to bottom, #fefae0 0%, transparent 100%);
        }
        
        .text-scroll-container::after {
            bottom: 0;
            background: linear-gradient(to top, #fefae0 0%, transparent 100%);
        }
        
        .text-scroll-container.scrolling::before,
        .text-scroll-container.scrolling::after {
            opacity: 1;
        }
        
        .letter-signature {
            text-align: right;
            font-style: italic;
            color: #333333 !important;
            margin-top: 10px;
            font-size: 0.95rem;
            padding-top: 15px;
            border-top: 1px dashed rgba(157, 92, 99, 0.3);
            flex-shrink: 0;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        
        /* –û–ë–†–ê–¢–ù–ê–Ø –°–¢–û–†–û–ù–ê –ü–ò–°–¨–ú–ê (–§–û–¢–û) */
        .letter-photo {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 4px;
        }
        
        /* –ü–û–î–°–ö–ê–ó–ö–ò */
        .envelope-hint {
            margin-top: 30px;
            color: rgba(255,255,255,0.8);
            font-family: 'Merriweather', serif;
            font-size: 1.1rem;
            text-align: center;
            animation: hintPulse 2s infinite;
            padding: 10px 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 20px;
            backdrop-filter: blur(5px);
            transition: opacity 0.5s;
            z-index: 2;
        }
        
        .letter-hint {
            position: absolute;
            bottom: -40px;
            left: 0;
            width: 100%;
            color: rgba(255,255,255,0.8);
            font-family: 'Merriweather', serif;
            font-size: 0.9rem;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 2;
        }
        
        .letter-wrapper.extracted .letter-hint {
            opacity: 1;
            animation: hintPulse 2s infinite;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∏—Å—å–º–∞ */
        .close-letter-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 31;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .letter-wrapper.centered .close-letter-btn {
            display: flex;
        }
        
        @keyframes hintPulse {
            0%, 100% { opacity: 0.7; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-5px); }
        }
        
        /* –ö–ù–û–ü–ö–ê –í–û–ó–í–†–ê–¢–ê */
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-family: 'Merriweather', serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            z-index: 25;
        }
        
        .back-button:active {
            background: rgba(255,255,255,0.1);
            transform: scale(0.95);
        }
        
        /* –ú–£–ó–´–ö–ê */
        .music-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
            z-index: 10;
            font-family: 'Merriweather', serif;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            opacity: 0;
        }
        
        .music-btn.active {
            opacity: 1;
        }
        
        .music-btn:active {
            background: rgba(255,255,255,0.1);
            transform: scale(0.95);
        }
        
        /* –ê–î–ê–ü–¢–ò–í–ù–´–ô –†–ê–ó–ú–ï–† –ü–ò–°–¨–ú–ê */
        @media (max-height: 700px) {
            .letter-container {
                width: 95%;
                max-width: 350px;
            }
            
            .letter-front {
                padding: 20px 25px 30px 25px;
            }
            
            .letter-title {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }
            
            .text-scroll-container {
                min-height: 100px;
                max-height: 200px;
            }
            
            .text-content {
                font-size: 0.9rem;
                line-height: 1.5;
            }
            
            .letter-signature {
                min-height: 50px;
                font-size: 0.9rem;
                padding-top: 12px;
            }
        }
        
        @media (max-height: 600px) {
            .letter-container {
                width: 95%;
                max-width: 320px;
                max-height: 85vh;
            }
            
            .letter-front {
                padding: 15px 20px 25px 20px;
            }
            
            .letter-title {
                font-size: 1.2rem;
                margin-bottom: 12px;
            }
            
            .text-scroll-container {
                min-height: 80px;
                max-height: 180px;
            }
            
            .text-content {
                font-size: 0.85rem;
                line-height: 1.4;
            }
            
            .letter-signature {
                min-height: 45px;
                font-size: 0.85rem;
                padding-top: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .letter-container {
                width: 90%;
                max-width: 300px;
            }
            
            .letter-wrapper.extracted {
                top: -10px !important;
            }
            
            /* –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–∏—Ü –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .petal, .fire-particle, .glow-particle, .sparkle, .snowflake {
                transform: scale(0.7);
            }
        }
        
        /* –û—Ç–∫–ª—é—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ prefers-reduced-motion */
        @media (prefers-reduced-motion: reduce) {
            .petal, .fire-particle, .glow-particle, .sparkle, .snowflake,
            .fire-effect, .glow-effect {
                animation: none !important;
                opacity: 0.5;
            }
        }
    </style>
</head>
<body>
    <!-- –û–°–ù–û–í–ù–û–ô –≠–ö–†–ê–ù -->
    <div id="main">
        <!-- –§–û–ù–´ - –ó–ê–ú–ï–ù–ï–ù–´ –ù–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø -->
        <!-- 
            –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ó–∞–º–µ–Ω–∏—Ç–µ URL –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö style –Ω–∞ —Å–≤–æ–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            –§–æ—Ä–º–∞—Ç: style="background-image: url('–í–ê–®–ê_–°–°–´–õ–ö–ê');"
        -->
        
        <div class="scene-bg active" style="background-image: url('https://i.ibb.co/rRzcgNQk/3c1327c1e3bbe652dae8b7354ff7fbad.jpg');"></div>
        <div class="scene-bg" style="background-image: url('https://i.ibb.co/b58r2pQm/garden.jpg');"></div>
        <div class="scene-bg" style="background-image: url('https://i.ibb.co/ynqFcW1v/knight.jpg');"></div>
        <div class="scene-bg" style="background-image: url('https://i.ibb.co/7tynfbzm/aurora.jpg');"></div>
        <div class="scene-bg" style="background-image: url('https://i.ibb.co/3mVjm7SN/4b67ce9937def895d1abe7288850eed5.jpg');"></div>
        <div class="scene-bg" style="background-image: url('https://i.ibb.co/Nn2vF2z0/winter.jpg');"></div>
        
        <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –≠–§–§–ï–ö–¢–û–í -->
        <div class="effects-container" id="effectsContainer"></div>
        
        <!-- –ù–ê–ß–ê–õ–¨–ù–ê–Ø –°–¶–ï–ù–ê (–ó–ê–ü–£–°–ö) -->
        <div class="start-scene" id="startScene">
            <h1 class="start-title">–£–ø—É—â–µ–Ω–Ω—ã–µ –º–≥–Ω–æ–≤–µ–Ω–∏—è</h1>
            <p class="start-subtitle">–ü–æ—ç—Ç–∏—á–µ—Å–∫–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</p>
            <button class="start-button" id="startButton">–ù–∞—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä</button>
            <div class="start-hint">–ú–æ–∂–Ω–æ –ª–∏—Å—Ç–∞—Ç—å —Å–≤–∞–π–ø–∞–º–∏ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑</div>
        </div>
        
        <!-- –û–°–ù–û–í–ù–´–ï –°–¶–ï–ù–´ –° –¢–ï–ö–°–¢–û–ú -->
        <div class="text-container" id="textContainer">
            <div class="text-line" data-scene="1">
                <div class="text">–≠—Ç–æ –∏—Å—Ç–æ—Ä–∏—è –æ —Ç–æ–º,
<br></br>
				  –ö–∞–∫ –ø–æ–≤—Å—Ç—Ä–µ—á–∞–ª –ø—Ä–µ–∫—Ä–∞—Å–Ω—É—é –ø–µ—Ä—Å–æ–Ω—É.	</div>
            </div>
            <div class="text-line" data-scene="2">
                <div class="text">–í —Ç–µ–±–µ —É–≤–∏–¥–µ–ª —Ç–µ–ø–ª–æ—Ç—É
<br></br>			  –ò —Å–∞–¥ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è —Ü–≤–µ—Ç—É—â–∏–π
<br></br>			  –ö–∞–∫ —è—Ä–∫–∏–π –ª—É—á –ø—Ä–æ–±–∏–ª–∞—Å—å —Ç—ã –≤–æ —Ç—å–º—É
<br></br>			  –í—Å–µ –æ—Å–≤–µ—â–∞—è —Ñ–∞–∫–µ–ª–æ–º –≥–æ—Ä—è—â–∏–º</div>
            </div>
            <div class="text-line" data-scene="3">
                <div class="text">–ö–∞–∫ —Ä—ã—Ü–∞—Ä—å —è –≥–æ—Ç–æ–≤
<br></br>			  –ù–∞ –≤–µ—Ä–Ω–æ—Å—Ç—å –ø—Ä–∏—Å—è–≥–Ω—É—Ç—å —Ç–µ–±–µ,
<br></br>			  –ò –æ–±–µ—Ä–µ–≥–∞—Ç—å –æ—Ç –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤
<br></br>			  –î–æ –¥–Ω–µ–π —Å–≤–æ–∏—Ö –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤ —ç—Ç–æ–º –º–∏—Ä–µ</div>
            </div>
            <div class="text-line" data-scene="4">
                <div class="text">–≠—Ç–æ—Ç –º–∏—Ä –±–æ–ª—å—à–æ–π
<br></br>			  –ù–æ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ–º –µ—Å—Ç—å —á–µ–ª–æ–≤–µ–∫
<br></br>			  –ö–æ—Ç–æ—Ä—ã–π –¥–æ—Ä–æ–≥ –º–Ω–µ
<br></br>			  –£–∂–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è</div>
            </div>
            <div class="text-line" data-scene="5">
                <div class="text">–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏,
<br></br>			  –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –º—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å
<br></br>			  –ò –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–ª–æ–∂–Ω–æ,
<br></br>			  –ù–æ –æ–¥–Ω–æ —è –∑–Ω–∞—é —Ç–æ—á–Ω–æ</div>
            </div>
            <div class="text-line" data-scene="6">
                <div class="text">–¢—ã
<br></br>		          –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –∂–µ–ª–∞–Ω–∏–µ</div>
            </div>
        </div>
        
        <!-- –ò–ù–î–ò–ö–ê–¢–û–† -->
        <div class="dots" id="dots">
            <div class="dot active" data-scene="1"></div>
            <div class="dot" data-scene="2"></div>
            <div class="dot" data-scene="3"></div>
            <div class="dot" data-scene="4"></div>
            <div class="dot" data-scene="5"></div>
            <div class="dot" data-scene="6"></div>
        </div>
        
        <!-- –ú–£–ó–´–ö–ê -->
        <button class="music-btn" id="musicBtn">‚ô™</button>
        
        <!-- –û–¢–î–ï–õ–¨–ù–ê–Ø –°–¶–ï–ù–ê –ö–û–ù–í–ï–†–¢–ê -->
        <div class="envelope-scene" id="envelopeScene">
            <!-- –ö–ù–û–ü–ö–ê –í–û–ó–í–†–ê–¢–ê -->
            <button class="back-button" id="backButton">‚Üê –ù–∞–∑–∞–¥ –∫ —Å—Ç–∏—Ö–∞–º</button>
            
            <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ö–û–ù–í–ï–†–¢–ê –ò –ü–ò–°–¨–ú–ê -->
            <div class="envelope-container">
                <!-- –ö–û–ù–í–ï–†–¢ -->
                <div class="envelope-wrapper">
                    <div class="envelope" id="envelope">
                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å -->
                        <div class="envelope-base"></div>
                        
                        <!-- –ú–∞—Ä–∫–∞ -->
                        <div class="envelope-stamp">–ü–û–ß–¢–ê</div>
                        
                        <!-- –ê–¥—Ä–µ—Å -->
                        <div class="envelope-address">
                            –î–ª—è —Å–∞–º–æ–≥–æ –≤–∞–∂–Ω–æ–≥–æ<br>
                            —á–µ–ª–æ–≤–µ–∫–∞
                        </div>
                        
                        <!-- –ö–ª–∞–ø–∞–Ω -->
                        <div class="envelope-flap"></div>
                    </div>
                </div>
                
                <!-- –ü–ò–°–¨–ú–û (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –°–ö–†–´–¢–û –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞) -->
                <div class="letter-wrapper" id="letterWrapper">
                    <button class="close-letter-btn" id="closeLetterBtn">√ó</button>
                    <div class="letter-container">
                        <div class="letter" id="letter">
                            <!-- –õ–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ -->
                            <div class="letter-front">
                                <div class="letter-content">
                                    <h3 class="letter-title">–ñ–µ–ª–∞–Ω–∏–µ –Ω–∞ –ù–æ–≤—ã–π –ì–æ–¥</h3>
                                    <div class="text-scroll-container" id="textScrollContainer">
                                        <div class="text-content" id="textContent">
                                            –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - —ç—Ç–æ —á–∞—Å—Ç–∏—á–∫–∞ —Ç–µ–ø–ª–∞ –∏ —Å–≤–µ—Ç–∞, 
					    –∫–æ—Ç–æ—Ä—ã–µ —è —Ö–æ—á—É –ø–µ—Ä–µ–¥–∞—Ç—å —Ç–µ–±–µ. –í—Å—Ç—Ä–µ—á–∞ —Å —Ç–æ–±–æ–π,  
                                            —Å–∞–º–æ–µ –ª—É—á—à–µ–µ —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ —ç—Ç–æ–º –≥–æ–¥—É. 
					    –ú–æ–µ –∂–µ–ª–∞–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥ —Ç–æ–ª—å–∫–æ —á—Ç–æ–±—ã —É –Ω–∞—Å –≤—Å–µ —Å–ª–æ–∂–∏–ª–æ—Å—å. 
					    –õ—é–±–ª—é —Ç–µ–±—è –≤—Å–µ–º —Å–µ—Ä–¥—Ü–µ–º –∏ —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ª–æ–≤–∞. –ù–∞–∂–º–∏ –Ω–∞ –ø–∏—Å—å–º–æ :)
					    
                                        </div>
                                    </div>
                                    <div class="letter-signature">
                                        –° —Ç–µ–ø–ª–æ–º,<br>
                                        –¢–æ—Ç, –∫—Ç–æ –ª—é–±–∏—Ç —Ç–µ–±—è
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (—Ñ–æ—Ç–æ) -->
                            <div class="letter-back">
                                <img src="https://i.ibb.co/bg3X4qng/IMG-20251212-184226.jpg" 
                                     alt="–°—á–∞—Å—Ç–ª–∏–≤—ã–π –º–æ–º–µ–Ω—Ç" class="letter-photo">
                            </div>
                        </div>
                    </div>
                    <div class="letter-hint">–ù–∞–∂–º–∏ –Ω–∞ –ø–∏—Å—å–º–æ, —á—Ç–æ–±—ã –ø—Ä–∏–±–ª–∏–∑–∏—Ç—å</div>
                </div>
            </div>
            
            <!-- –ü–û–î–°–ö–ê–ó–ö–ê -->
            <div class="envelope-hint" id="envelopeHint">
                –ù–∞–∂–º–∏ –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–∏—Å—å–º–æ
            </div>
        </div>
    </div>

    <script>
        window.addEventListener('load', function() {
            console.log('üé¨ –ü–æ—ç—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∏–ª—å–º –∑–∞–≥—Ä—É–∂–µ–Ω');
            document.getElementById('main').style.opacity = '1';
            
            // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            preloadBackgroundImages();
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∑–∞—Ä–∞–Ω–µ–µ
            createAllEffects();
            
            initFilm();
        });
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function preloadBackgroundImages() {
            console.log('üñºÔ∏è –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...');
            
            const bgElements = document.querySelectorAll('.scene-bg');
            const loadedImages = [];
            
            bgElements.forEach((bg, index) => {
                const bgStyle = bg.style.backgroundImage;
                if (bgStyle && bgStyle !== 'none') {
                    const bgUrl = bgStyle
                        .replace('url("', '')
                        .replace('")', '')
                        .replace("url('", "")
                        .replace("')", "");
                    
                    if (bgUrl) {
                        const img = new Image();
                        img.src = bgUrl;
                        img.onload = () => {
                            console.log(`‚úì –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index + 1} –∑–∞–≥—Ä—É–∂–µ–Ω–æ`);
                            loadedImages.push(true);
                            if (loadedImages.length === bgElements.length) {
                                console.log('‚úÖ –í—Å–µ —Ñ–æ–Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                            }
                        };
                        img.onerror = () => {
                            console.warn(`‚úó –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ${index + 1}`);
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback —Ü–≤–µ—Ç, –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
                            bg.style.backgroundImage = 'none';
                            bg.style.backgroundColor = getFallbackColor(index);
                        };
                    }
                }
            });
        }
        
        // Fallback —Ü–≤–µ—Ç–∞ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è
        function getFallbackColor(index) {
            const colors = [
                '#1a1a2e',
                '#0f3460',
                '#1a1a2e',
                '#533483',
                '#e94560',
                '#ff6b6b'
            ];
            return colors[index] || '#1a1a2e';
        }
        
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        let currentScene = 1;
        const totalScenes = 6;
        let autoPlayTimer;
        let isFilmStarted = false;
        let isEnvelopeOpened = false;
        let isLetterExtracted = false;
        let isLetterFlipped = false;
        let isLetterCentered = false;
        let isTextScrolling = false;
        
        // –°–û–ó–î–ê–ù–ò–ï –í–°–ï–• –≠–§–§–ï–ö–¢–û–í –ó–ê–†–ê–ù–ï–ï
        function createAllEffects() {
            console.log('‚ú® –°–æ–∑–¥–∞—ë–º —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω...');
            const effectsContainer = document.getElementById('effectsContainer');
            
            // –°—Ü–µ–Ω–∞ 2: –†–æ–∑–æ–≤—ã–µ –ª–µ–ø–µ—Å—Ç–∫–∏
            createScene2Effects(effectsContainer);
            
            // –°—Ü–µ–Ω–∞ 3: –ì–æ—Ä—è—â–∏–π –æ–≥–æ–Ω—å
            createScene3Effects(effectsContainer);
            
            // –°—Ü–µ–Ω–∞ 4: –°–∏—è–Ω–∏–µ —Å–≤–µ—Ä—Ö—É
            createScene4Effects(effectsContainer);
            
            // –°—Ü–µ–Ω–∞ 5: –ú–µ—Ä—Ü–∞—é—â–∏–µ –æ–≥–æ–Ω—å–∫–∏
            createScene5Effects(effectsContainer);
            
            // –°—Ü–µ–Ω–∞ 6: –ü–∞–¥–∞—é—â–∏–π —Å–Ω–µ–≥
            createScene6Effects(effectsContainer);
            
            // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (—Å—Ü–µ–Ω–∞ 1 –±–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤)
            hideAllEffects();
        }
        
        // –°–û–ó–î–ê–ù–ò–ï –≠–§–§–ï–ö–¢–û–í –î–õ–Ø –ö–ê–ñ–î–û–ô –°–¶–ï–ù–´
        function createScene2Effects(container) {
            // –°–æ–∑–¥–∞—ë–º 15 –ª–µ–ø–µ—Å—Ç–∫–æ–≤
            for (let i = 0; i < 15; i++) {
                const petal = document.createElement('div');
                petal.className = 'petal effect';
                
                // –°–ª—É—á–∞–π–Ω—ã–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
                const left = Math.random() * 100;
                const delay = Math.random() * 5;
                const duration = 10 + Math.random() * 10;
                
                petal.style.left = `${left}%`;
                petal.style.animationDuration = `${duration}s`;
                petal.style.animationDelay = `${delay}s`;
                
                container.appendChild(petal);
            }
        }
        
        function createScene3Effects(container) {
            // –û—Å–Ω–æ–≤–Ω–æ–π –æ–≥–Ω–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
            const fireEffect = document.createElement('div');
            fireEffect.className = 'fire-effect effect';
            container.appendChild(fireEffect);
            
            // –°–æ–∑–¥–∞—ë–º 20 –æ–≥–Ω–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü
            for (let i = 0; i < 20; i++) {
                const fireParticle = document.createElement('div');
                fireParticle.className = 'fire-particle effect';
                
                // –°–ª—É—á–∞–π–Ω—ã–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                const left = Math.random() * 100;
                const delay = Math.random() * 3;
                const duration = 2 + Math.random() * 2;
                
                fireParticle.style.left = `${left}%`;
                fireParticle.style.animationDuration = `${duration}s`;
                fireParticle.style.animationDelay = `${delay}s`;
                
                container.appendChild(fireParticle);
            }
        }
        
        function createScene4Effects(container) {
            // –û—Å–Ω–æ–≤–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç —Å–∏—è–Ω–∏—è
            const glowEffect = document.createElement('div');
            glowEffect.className = 'glow-effect effect';
            container.appendChild(glowEffect);
            
            // –°–æ–∑–¥–∞—ë–º 10 —Å–∏—è—é—â–∏—Ö —á–∞—Å—Ç–∏—Ü
            for (let i = 0; i < 10; i++) {
                const glowParticle = document.createElement('div');
                glowParticle.className = 'glow-particle effect';
                
                // –°–ª—É—á–∞–π–Ω—ã–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                const left = Math.random() * 100;
                const delay = Math.random() * 2;
                const duration = 4 + Math.random() * 4;
                
                glowParticle.style.left = `${left}%`;
                glowParticle.style.animationDuration = `${duration}s`;
                glowParticle.style.animationDelay = `${delay}s`;
                
                container.appendChild(glowParticle);
            }
        }
        
        function createScene5Effects(container) {
            // –°–æ–∑–¥–∞—ë–º 25 –º–µ—Ä—Ü–∞—é—â–∏—Ö –æ–≥–æ–Ω—å–∫–æ–≤
            for (let i = 0; i < 25; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle effect';
                
                // –°–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –≤—Å–µ–º—É —ç–∫—Ä–∞–Ω—É
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                const delay = Math.random() * 3;
                const duration = 2 + Math.random() * 2;
                
                sparkle.style.left = `${left}%`;
                sparkle.style.top = `${top}%`;
                sparkle.style.animationDuration = `${duration}s`;
                sparkle.style.animationDelay = `${delay}s`;
                
                container.appendChild(sparkle);
            }
        }
        
        function createScene6Effects(container) {
            // –°–æ–∑–¥–∞—ë–º 30 —Å–Ω–µ–∂–∏–Ω–æ–∫
            for (let i = 0; i < 30; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake effect';
                
                // –°–ª—É—á–∞–π–Ω—ã–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                const left = Math.random() * 100;
                const delay = Math.random() * 5;
                const duration = 15 + Math.random() * 10;
                
                snowflake.style.left = `${left}%`;
                snowflake.style.animationDuration = `${duration}s`;
                snowflake.style.animationDelay = `${delay}s`;
                
                container.appendChild(snowflake);
            }
        }
        
        // –°–ö–†–´–¢–¨ –í–°–ï –≠–§–§–ï–ö–¢–´
        function hideAllEffects() {
            const allEffects = document.querySelectorAll('.effect');
            allEffects.forEach(effect => {
                effect.classList.remove('visible');
                effect.classList.add('hidden');
            });
        }
        
        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–§–§–ï–ö–¢–ê–ú–ò - –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø (–≤–∞—Ä–∏–∞–Ω—Ç 6)
        function showEffectsForScene(sceneNum) {
            console.log(`üé≠ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è —Å—Ü–µ–Ω—ã ${sceneNum}`);
            
            // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            hideAllEffects();
            
            // –ó–∞—Ç–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            let selector = '';
            
            switch(sceneNum) {
                case 2:
                    selector = '.petal';
                    break;
                case 3:
                    selector = '.fire-effect, .fire-particle';
                    break;
                case 4:
                    selector = '.glow-effect, .glow-particle';
                    break;
                case 5:
                    selector = '.sparkle';
                    break;
                case 6:
                    selector = '.snowflake';
                    break;
                default:
                    // –°—Ü–µ–Ω—ã 1 –∏ –∫–æ–Ω–≤–µ—Ä—Ç - –±–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                    selector = '';
            }
            
            if (selector) {
                document.querySelectorAll(selector).forEach(effect => {
                    effect.classList.remove('hidden');
                    effect.classList.add('visible');
                });
            }
        }
        
        function initFilm() {
            console.log('üéûÔ∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å–º–∞');
            
            // –≠–õ–ï–ú–ï–ù–¢–´
            const startScene = document.getElementById('startScene');
            const startButton = document.getElementById('startButton');
            const textContainer = document.getElementById('textContainer');
            const dots = document.getElementById('dots');
            const musicBtn = document.getElementById('musicBtn');
            const backgrounds = document.querySelectorAll('.scene-bg');
            const textLines = document.querySelectorAll('.text-line');
            const dotElements = document.querySelectorAll('.dot');
            const envelopeScene = document.getElementById('envelopeScene');
            const envelope = document.getElementById('envelope');
            const letterWrapper = document.getElementById('letterWrapper');
            const letter = document.getElementById('letter');
            const textScrollContainer = document.getElementById('textScrollContainer');
            const textContent = document.getElementById('textContent');
            const envelopeHint = document.getElementById('envelopeHint');
            const backButton = document.getElementById('backButton');
            const closeLetterBtn = document.getElementById('closeLetterBtn');
            
            // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–í–¢–û–ü–†–û–ö–†–£–¢–ö–ò –¢–ï–ö–°–¢–ê
            function startAutoScroll() {
                if (!textContent || isTextScrolling) return;
                
                console.log('üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ç–µ–∫—Å—Ç–∞');
                
                const textHeight = textContent.scrollHeight;
                const containerHeight = textScrollContainer.clientHeight;
                
                console.log('–í—ã—Å–æ—Ç–∞ —Ç–µ–∫—Å—Ç–∞:', textHeight, '–í—ã—Å–æ—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:', containerHeight);
                
                if (textHeight <= containerHeight + 10) {
                    console.log('–¢–µ–∫—Å—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–º–µ—â–∞–µ—Ç—Å—è, –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞');
                    return;
                }
                
                isTextScrolling = true;
                textScrollContainer.classList.add('scrolling');
                
                const scrollDistance = textHeight - containerHeight;
                const scrollSpeed = Math.max(40, scrollDistance * 0.1);
                
                console.log('–°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏:', scrollSpeed + '—Å–µ–∫');
                
                textContent.classList.add('scrolling');
                textContent.style.animationDuration = scrollSpeed + 's';
                
                console.log('–ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∑–∞–ø—É—â–µ–Ω–∞');
            }
            
            function stopAutoScroll() {
                if (!textContent || !isTextScrolling) return;
                
                console.log('‚è∏Ô∏è –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ç–µ–∫—Å—Ç–∞');
                isTextScrolling = false;
                textContent.classList.remove('scrolling');
                textScrollContainer.classList.remove('scrolling');
                
                textContent.style.transform = 'translateY(0)';
                textContent.style.animation = 'none';
            }
            
            // –ù–ê–ß–ê–õ–¨–ù–ê–Ø –°–¶–ï–ù–ê - –ö–ù–û–ü–ö–ê –ó–ê–ü–£–°–ö–ê
            startButton.addEventListener('click', function() {
                startFilm();
            });
            
            startScene.addEventListener('click', function(e) {
                if (e.target === startScene) {
                    startFilm();
                }
            });
            
            // –§–£–ù–ö–¶–ò–Ø –ó–ê–ü–£–°–ö–ê –§–ò–õ–¨–ú–ê
            function startFilm() {
                if (isFilmStarted) return;
                
                isFilmStarted = true;
                console.log('üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–∏–ª—å–º');
                
                startScene.style.opacity = '0';
                setTimeout(function() {
                    startScene.style.display = 'none';
                }, 500);
                
                textContainer.classList.add('active');
                dots.classList.add('active');
                musicBtn.classList.add('active');
                
                goToScene(1);
                startAutoPlay();
                setupSwipes();
                setupEnvelope();
                setupMusic();
                
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
            }
            
            // –§–£–ù–ö–¶–ò–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –°–¶–ï–ù–´
            function goToScene(num) {
                if (num < 1 || num > totalScenes) return;
                
                currentScene = num;
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ñ–æ–Ω
                backgrounds.forEach(bg => bg.classList.remove('active'));
                if (backgrounds[num - 1]) {
                    backgrounds[num - 1].classList.add('active');
                }
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–∫—Å—Ç
                textLines.forEach(line => line.classList.remove('active'));
                textLines.forEach(line => {
                    if (parseInt(line.getAttribute('data-scene')) === num) {
                        line.classList.add('active');
                    }
                });
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
                dotElements.forEach(dot => dot.classList.remove('active'));
                dotElements.forEach(dot => {
                    if (parseInt(dot.getAttribute('data-scene')) === num) {
                        dot.classList.add('active');
                    }
                });
                
                // –£–ø—Ä–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
                showEffectsForScene(num);
                
                if (navigator.vibrate) {
                    navigator.vibrate(20);
                }
                
                if (num === totalScenes && !isEnvelopeOpened) {
                    setTimeout(function() {
                        showEnvelopeScene();
                    }, 3500);
                }
            }
            
            // –ü–û–ö–ê–ó–ê–¢–¨ –°–¶–ï–ù–£ –ö–û–ù–í–ï–†–¢–ê
            function showEnvelopeScene() {
                clearInterval(autoPlayTimer);
                textContainer.classList.remove('active');
                dots.classList.remove('active');
                envelopeScene.classList.add('active');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ –∫–æ–Ω–≤–µ—Ä—Ç—É
                hideAllEffects();
                
                resetEnvelope();
            }
            
            // –í–û–ó–í–†–ê–¢ –ö –°–¢–ò–•–ê–ú
            backButton.addEventListener('click', function() {
                envelopeScene.classList.remove('active');
                resetEnvelope();
                stopAutoScroll();
                textContainer.classList.add('active');
                dots.classList.add('active');
                goToScene(1);
                startAutoPlay();
            });
            
            // –ö–ù–û–ü–ö–ê –ó–ê–ö–†–´–¢–ò–Ø –ü–ò–°–¨–ú–ê –í –¶–ï–ù–¢–†–ò–†–û–í–ê–ù–ù–û–ú –†–ï–ñ–ò–ú–ï
            closeLetterBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                if (isLetterCentered) {
                    uncenterLetter();
                }
            });
            
            // –°–ë–†–û–° –°–û–°–¢–û–Ø–ù–ò–Ø –ö–û–ù–í–ï–†–¢–ê –ò –ü–ò–°–¨–ú–ê
            function resetEnvelope() {
                isEnvelopeOpened = false;
                isLetterExtracted = false;
                isLetterFlipped = false;
                isLetterCentered = false;
                
                stopAutoScroll();
                
                envelope.classList.remove('open');
                letterWrapper.classList.remove('extracted');
                letterWrapper.classList.remove('centered');
                letter.classList.remove('flipped');
                if (textContent) textContent.classList.remove('scrolling');
                if (textScrollContainer) textScrollContainer.classList.remove('scrolling');
                
                setTimeout(() => {
                    letterWrapper.style.opacity = '0';
                    letterWrapper.style.visibility = 'hidden';
                    letterWrapper.style.height = '140px';
                    letterWrapper.style.top = '20px';
                    letterWrapper.style.left = '20px';
                    letterWrapper.style.width = '240px';
                    letterWrapper.style.zIndex = '0';
                    letterWrapper.style.pointerEvents = 'none';
                    letterWrapper.style.position = 'absolute';
                    letterWrapper.style.overflow = 'visible';
                    letterWrapper.style.background = 'transparent';
                    letterWrapper.style.backdropFilter = 'none';
                    letterWrapper.style.display = 'block';
                    letterWrapper.style.padding = '0';
                    
                    if (textContent) {
                        textContent.style.transform = 'translateY(0)';
                        textContent.style.animation = 'none';
                    }
                }, 100);
                
                envelopeHint.style.opacity = '1';
                envelopeHint.textContent = '–ù–∞–∂–º–∏ –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–∏—Å—å–º–æ';
                document.querySelector('.letter-hint').style.opacity = '0';
            }
            
            // –ù–ê–°–¢–†–û–ô–ö–ê –ö–û–ù–í–ï–†–¢–ê –ò –ü–ò–°–¨–ú–ê
            function setupEnvelope() {
                console.log('–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω–≤–µ—Ä—Ç –∏ –ø–∏—Å—å–º–æ...');
                
                // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞
                envelope.addEventListener('click', function(e) {
                    console.log('–ö–ª–∏–∫ –ø–æ –∫–æ–Ω–≤–µ—Ä—Ç—É, isEnvelopeOpened:', isEnvelopeOpened, 'isLetterExtracted:', isLetterExtracted);
                    
                    if (!isEnvelopeOpened) {
                        isEnvelopeOpened = true;
                        envelope.classList.add('open');
                        envelopeHint.style.opacity = '0';
                        
                        console.log('–ö–æ–Ω–≤–µ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç, –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å –ø–∏—Å—å–º–∞');
                        
                        playSuccessSound();
                        
                        setTimeout(function() {
                            envelopeHint.textContent = '–ù–∞–∂–º–∏—Ç–µ –µ—â—ë —Ä–∞–∑, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∞—Ç—å –ø–∏—Å—å–º–æ';
                            envelopeHint.style.opacity = '1';
                        }, 600);
                        
                    } else if (!isLetterExtracted) {
                        console.log('–ü–∏—Å—å–º–æ –≤—ã–µ–∑–∂–∞–µ—Ç –∏–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞');
                        extractLetter();
                    }
                });
                
                // –ö–ª–∏–∫ –ø–æ –ø–∏—Å—å–º—É –¥–ª—è –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∏–ª–∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
                letter.addEventListener('click', function() {
                    console.log('–ö–ª–∏–∫ –ø–æ –ø–∏—Å—å–º—É, isLetterExtracted:', isLetterExtracted, 'isLetterCentered:', isLetterCentered, 'isLetterFlipped:', isLetterFlipped);
                    
                    if (isLetterExtracted && !isLetterCentered) {
                        console.log('–¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–∏—Å—å–º–æ');
                        centerLetter();
                    } else if (isLetterExtracted && isLetterCentered && !isLetterFlipped) {
                        console.log('–ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø–∏—Å—å–º–æ');
                        flipLetter();
                    } else if (isLetterExtracted && isLetterCentered && isLetterFlipped) {
                        console.log('–í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–∏—Å—å–º–æ');
                        unflipLetter();
                    }
                });
                
                // –ö–ª–∏–∫ –ø–æ —Ñ–æ–Ω—É –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                letterWrapper.addEventListener('click', function(e) {
                    if (isLetterCentered && e.target === letterWrapper) {
                        console.log('–ö–ª–∏–∫ –ø–æ —Ñ–æ–Ω—É - –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞');
                        uncenterLetter();
                    }
                });
                
                if (textScrollContainer) {
                    textScrollContainer.addEventListener('mouseenter', function() {
                        if (isTextScrolling && textContent) {
                            textContent.style.animationPlayState = 'paused';
                        }
                    });
                    
                    textScrollContainer.addEventListener('mouseleave', function() {
                        if (isTextScrolling && textContent) {
                            textContent.style.animationPlayState = 'running';
                        }
                    });
                    
                    textScrollContainer.addEventListener('touchstart', function() {
                        if (isTextScrolling && textContent) {
                            textContent.style.animationPlayState = 'paused';
                        }
                    });
                    
                    textScrollContainer.addEventListener('touchend', function() {
                        setTimeout(() => {
                            if (isTextScrolling && textContent) {
                                textContent.style.animationPlayState = 'running';
                            }
                        }, 2000);
                    });
                }
            }
            
            // –ü–ò–°–¨–ú–û –í–´–ï–ó–ñ–ê–ï–¢ –ò–ó –ö–û–ù–í–ï–†–¢–ê
            function extractLetter() {
                isLetterExtracted = true;
                letterWrapper.classList.add('extracted');
                envelopeHint.style.opacity = '0';
                
                console.log('–ü–∏—Å—å–º–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞');
                
                setTimeout(() => {
                    if (textContent) {
                        textContent.style.opacity = '1';
                        textContent.style.visibility = 'visible';
                    }
                }, 100);
                
                if (navigator.vibrate) {
                    navigator.vibrate(40);
                }
                
                playExtractSound();
                createConfetti();
                
                setTimeout(() => {
                    document.querySelector('.letter-hint').textContent = '–ù–∞–∂–º–∏ –Ω–∞ –ø–∏—Å—å–º–æ, —á—Ç–æ–±—ã –ø—Ä–∏–±–ª–∏–∑–∏—Ç—å';
                    document.querySelector('.letter-hint').style.opacity = '1';
                    
                    envelopeHint.textContent = '–¢–µ–ø–µ—Ä—å –Ω–∞–∂–º–∏ –Ω–∞ –ø–∏—Å—å–º–æ';
                    envelopeHint.style.opacity = '1';
                }, 1000);
            }
            
            // –¶–ï–ù–¢–†–ò–†–û–í–ê–ù–ò–ï –ü–ò–°–¨–ú–ê - –ö–õ–Æ–ß–ï–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï
            function centerLetter() {
                isLetterCentered = true;
                letterWrapper.classList.add('centered');
                
                console.log('–ü–∏—Å—å–º–æ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                document.querySelector('.letter-hint').textContent = '';
                document.querySelector('.letter-hint').style.opacity = '0';
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                setTimeout(() => {
                    startAutoScroll();
                }, 1000);
                
                if (navigator.vibrate) {
                    navigator.vibrate([20, 30, 20]);
                }
                
                playCenterSound();
            }
            
            // –í–´–•–û–î –ò–ó –¶–ï–ù–¢–†–ò–†–û–í–ê–ù–ù–û–ì–û –†–ï–ñ–ò–ú–ê
            function uncenterLetter() {
                isLetterCentered = false;
                letterWrapper.classList.remove('centered');
                
                console.log('–ü–∏—Å—å–º–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ –∏–∑ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞');
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É
                stopAutoScroll();
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                setTimeout(() => {
                    document.querySelector('.letter-hint').textContent = '–ù–∞–∂–º–∏ –Ω–∞ –ø–∏—Å—å–º–æ, —á—Ç–æ–±—ã –ø—Ä–∏–±–ª–∏–∑–∏—Ç—å';
                    document.querySelector('.letter-hint').style.opacity = '1';
                }, 300);
                
                if (navigator.vibrate) {
                    navigator.vibrate([20, 30, 20]);
                }
                
                playCenterSound();
            }
            
            // –ü–ï–†–ï–í–û–†–û–¢ –ü–ò–°–¨–ú–ê
            function flipLetter() {
                isLetterFlipped = true;
                letter.classList.add('flipped');
                
                console.log('–ü–∏—Å—å–º–æ –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–æ');
                
                stopAutoScroll();
                
                if (navigator.vibrate) {
                    navigator.vibrate([20, 30, 20]);
                }
                
                playFlipSound();
                
                document.querySelector('.letter-hint').textContent = '–ù–∞–∂–º–∏ –µ—â—ë —Ä–∞–∑, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å';
            }
            
            // –û–ë–†–ê–¢–ù–´–ô –ü–ï–†–ï–í–û–†–û–¢ –ü–ò–°–¨–ú–ê
            function unflipLetter() {
                isLetterFlipped = false;
                letter.classList.remove('flipped');
                
                console.log('–ü–∏—Å—å–º–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ');
                
                setTimeout(() => {
                    startAutoScroll();
                }, 500);
                
                if (navigator.vibrate) {
                    navigator.vibrate([20, 30, 20]);
                }
                
                playFlipSound();
                
                document.querySelector('.letter-hint').textContent = '–ù–∞–∂–º–∏ –Ω–∞ –ø–∏—Å—å–º–æ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å';
            }
            
            // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –°–ú–ï–ù–ê
            function startAutoPlay() {
                if (autoPlayTimer) clearInterval(autoPlayTimer);
                
                autoPlayTimer = setInterval(function() {
                    let nextScene = currentScene + 1;
                    if (nextScene > totalScenes) nextScene = 1;
                    goToScene(nextScene);
                }, 5500);
            }
            
            // –°–í–ê–ô–ü–´
            function setupSwipes() {
                let startY = 0;
                let startTime = 0;
                
                document.addEventListener('touchstart', function(e) {
                    startY = e.touches[0].clientY;
                    startTime = Date.now();
                }, { passive: true });
                
                document.addEventListener('touchend', function(e) {
                    if (!startY || !isFilmStarted) return;
                    
                    const endY = e.changedTouches[0].clientY;
                    const diff = startY - endY;
                    const timeDiff = Date.now() - startTime;
                    
                    if (timeDiff < 300 && Math.abs(diff) > 40) {
                        if (diff > 0) {
                            let next = currentScene + 1;
                            if (next > totalScenes) next = 1;
                            goToScene(next);
                        } else {
                            let prev = currentScene - 1;
                            if (prev < 1) prev = totalScenes;
                            goToScene(prev);
                        }
                        
                        clearInterval(autoPlayTimer);
                        startAutoPlay();
                    }
                    
                    startY = 0;
                    startTime = 0;
                }, { passive: true });
                
                dotElements.forEach(dot => {
                    dot.addEventListener('click', function() {
                        if (!isFilmStarted) return;
                        
                        const sceneNum = parseInt(this.getAttribute('data-scene'));
                        if (sceneNum !== currentScene) {
                            goToScene(sceneNum);
                            clearInterval(autoPlayTimer);
                            startAutoPlay();
                        }
                    });
                });
            }
            
            // –ö–û–ù–§–ï–¢–¢–ò –≠–§–§–ï–ö–¢
            function createConfetti() {
                const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#9b5de5', '#ff8e53'];
                
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        const color = colors[Math.floor(Math.random() * colors.length)];
                        
                        confetti.style.cssText = `
                            position: fixed;
                            width: ${Math.random() * 12 + 6}px;
                            height: ${Math.random() * 12 + 6}px;
                            background: ${color};
                            top: 50%;
                            left: 50%;
                            border-radius: ${Math.random() > 0.5 ? '50%' : '2px'};
                            animation: confettiFall ${Math.random() * 2 + 1}s ease-out forwards;
                            z-index: 100;
                            pointer-events: none;
                            transform: rotate(${Math.random() * 360}deg);
                        `;
                        
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => {
                            if (confetti.parentNode) {
                                confetti.parentNode.removeChild(confetti);
                            }
                        }, 3000);
                    }, i * 30);
                }
                
                if (!document.querySelector('#confettiAnimation')) {
                    const style = document.createElement('style');
                    style.id = 'confettiAnimation';
                    style.textContent = `
                        @keyframes confettiFall {
                            0% { 
                                opacity: 1; 
                                transform: translate(0, 0) rotate(0deg); 
                            }
                            100% { 
                                opacity: 0; 
                                transform: translate(${Math.random() * 400 - 200}px, 100vh) 
                                rotate(${Math.random() * 720}deg); 
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
            
            // –ó–í–£–ö–ò
            function playSuccessSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                    oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3);
                    
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.8);
                } catch (e) {
                    console.log('–ó–≤—É–∫ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω:', e);
                }
            }
            
            function playExtractSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(220.00, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(440.00, audioContext.currentTime + 0.2);
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime + 0.3);
                    
                    gainNode.gain.setValueAtTime(0.12, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.8);
                } catch (e) {
                    console.log('–ó–≤—É–∫ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω:', e);
                }
            }
            
            function playCenterSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime + 0.2);
                    
                    gainNode.gain.setValueAtTime(0.12, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    console.log('–ó–≤—É–∫ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω:', e);
                }
            }
            
            function playFlipSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime + 0.2);
                    
                    gainNode.gain.setValueAtTime(0.08, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.6);
                } catch (e) {
                    console.log('–ó–≤—É–∫ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω:', e);
                }
            }
            
            // –ú–£–ó–´–ö–ê
            let audio = null;
            let isMusicPlaying = false;
            
            function setupMusic() {
                musicBtn.addEventListener('click', function() {
                    if (!audio) {
                        audio = new Audio();
                        audio.loop = true;
                        audio.volume = 0.4;
                        audio.src = 'https://assets.mixkit.co/music/preview/mixkit-happy-day-583.mp3';
                    }
                    
                    if (isMusicPlaying) {
                        audio.pause();
                        musicBtn.textContent = '‚ô™';
                        musicBtn.style.opacity = '0.7';
                    } else {
                        audio.play().then(function() {
                            musicBtn.textContent = '‚ñÆ‚ñÆ';
                            musicBtn.style.opacity = '1';
                            isMusicPlaying = true;
                        }).catch(function(e) {
                            console.log('–ú—É–∑—ã–∫–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å:', e);
                            musicBtn.title = '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–≤—É–∫–∞';
                        });
                    }
                    isMusicPlaying = !isMusicPlaying;
                });
            }
            
            console.log('‚úÖ –§–∏–ª—å–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –∂–¥—ë–º –∑–∞–ø—É—Å–∫–∞');
        }
    </script>
</body>
</html>
